<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLS Video Player with Quality Selector</title>
    <style>
        #player-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: #000;
        }
        video {
            width: 100%;
        }
        .quality-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="player-container">
    <video id="video" controls></video>
    <button class="quality-selector" id="quality-selector">Select Quality</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
    const video = document.getElementById('video');
    const qualitySelectorButton = document.getElementById('quality-selector');
    let hls = null;

    // URL of the HLS stream
    const streamUrl = 'https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8';

    // Initialize HLS.js
    if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(streamUrl);
        hls.attachMedia(video);

        // Event: When HLS is ready
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
            // Set up the quality selector after the manifest is parsed
            setupQualitySelector();
        });

        // Event: When the stream is successfully loaded
        hls.on(Hls.Events.MANIFEST_LOADED, function (event, data) {
            console.log('Manifest loaded, available quality levels:', data.levels);
        });

        // Event: If there's an error loading the stream
        hls.on(Hls.Events.ERROR, function (event, data) {
            if (data.fatal) {
                switch (data.type) {
                    case Hls.ErrorTypes.NETWORK_ERROR:
                        alert('Network error while loading the video.');
                        break;
                    case Hls.ErrorTypes.MEDIA_ERROR:
                    case Hls.ErrorTypes.OTHER_ERROR:
                        alert('Error while loading the video stream.');
                        break;
                    default:
                        break;
                }
            }
        });

    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        // If browser supports HLS natively (like Safari), use it
        video.src = streamUrl;
    } else {
        alert('HLS is not supported in this browser.');
    }

    // Setup the quality selector dropdown
    function setupQualitySelector() {
        const availableQualities = hls.levels.map((level, index) => {
            return {
                label: `${level.width}x${level.height} (${Math.round(level.bitrate / 1000)} kbps)`,
                index: index
            };
        });

        qualitySelectorButton.addEventListener('click', function () {
            let qualityMenu = availableQualities.map(quality => {
                return `<option value="${quality.index}">${quality.label}</option>`;
            }).join('');

            const qualityMenuHTML = `
                <select id="quality-menu">
                    ${qualityMenu}
                </select>
            `;

            // Show the dropdown menu
            const qualityMenuDiv = document.createElement('div');
            qualityMenuDiv.innerHTML = qualityMenuHTML;
            qualityMenuDiv.style.position = 'absolute';
            qualityMenuDiv.style.top = '40px';
            qualityMenuDiv.style.right = '10px';
            qualityMenuDiv.style.background = '#000';
            qualityMenuDiv.style.color = '#fff';
            qualityMenuDiv.style.border = '1px solid #ccc';
            qualityMenuDiv.style.padding = '10px';

            qualityMenuDiv.querySelector('#quality-menu').addEventListener('change', function () {
                const selectedIndex = this.value;
                hls.startLevel = parseInt(selectedIndex);
                hls.currentLevel = parseInt(selectedIndex);
                qualityMenuDiv.remove();
            });

            document.body.appendChild(qualityMenuDiv);
        });
    }

</script>

</body>
</html>
